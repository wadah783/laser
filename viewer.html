<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ø¹Ø±Ø¶ Ù…Ù„Ù Ø§Ù„Ø¨Ø§Ø­Ø«ÙŠÙ†</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      direction: rtl;
      margin: 0;
      padding: 0;
    }

    .topbar {
      background-color: #333;
      color: white;
      padding: 10px 20px;
      display: flex;
      justify-content: flex-start;
      align-items: center;
      gap: 30px;
    }

    .menu {
      position: relative;
      display: inline-block;
    }

    .menu button {
      background-color: #333;
      color: white;
      border: none;
      padding: 10px 16px;
      font-size: 16px;
      cursor: pointer;
    }

    .dropdown {
      display: none;
      position: absolute;
      top: 100%;
      right: 0;
      background-color: #fff;
      color: black;
      min-width: 250px;
      box-shadow: 0px 8px 16px rgba(0,0,0,0.2);
      z-index: 1;
      text-align: right;
    }

    .dropdown input,
    .dropdown button {
      width: calc(100% - 20px);
      margin: 5px 10px;
      box-sizing: border-box;
    }

    .dropdown button {
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      color: #333;
      padding: 6px;
      cursor: pointer;
    }

    #notice {
      font-size: 18px;
      margin: 20px;
      color: green;
    }

    .scrollable-table {
      overflow: auto;
      max-height: 500px;
      border: 1px solid #ccc;
      margin: 20px;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      min-width: 1200px;
    }

    th, td {
      border: 1px solid #999;
      padding: 8px;
      white-space: nowrap;
      text-align: right;
    }

    th {
      background-color: #f2f2f2;
    }

    .popup {
      display: none;
      position: fixed;
      z-index: 999;
      left: 50%;
      top: 45%;
      transform: translate(-50%, -50%);
      background-color: #fff;
      border: 2px solid #333;
      padding: 20px;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      max-width: 90%;
      text-align: right;
      overflow-y: auto;
      resize: both;
      max-height: 70%;
    }

    .popup button {
      margin-top: 10px;
    }

    .overlay {
      display: none;
      position: fixed;
      z-index: 998;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.5);
    }

    .link {
      color: blue;
      text-decoration: underline;
      cursor: pointer;
    }
  </style>
</head>
<body>

  <div class="topbar">
    <div class="menu">
      <button onclick="toggleMenu('fileMenu')">ğŸ“ Ù…Ù„Ù</button>
      <div class="dropdown" id="fileMenu">
        <button onclick="downloadCSV()">â¬‡ï¸ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù</button>
        <button onclick="downloadPopupContent()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>

    <div class="menu">
      <button onclick="toggleMenu('searchMenu')">ğŸ” Ø¨Ø­Ø«</button>
      <div class="dropdown" id="searchMenu">
        <input type="text" id="searchName" list="nameList" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«">
        <input type="text" id="columnName" list="columnList" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙˆØ¯">
        <button onclick="searchColumnValue()">ğŸ” Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯</button>
        <button onclick="searchAndShowData()">ğŸ“Œ Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ø¨Ø§Ø­Ø«</button>
      </div>
    </div>
  </div>
    
    <!-- Ù‚Ø§Ø¦Ù…Ø© Ø§Ø®ØªÙŠØ§Ø± Ø¨Ø§Ø­Ø« ÙˆØªØ­Ø¯ÙŠØ¯ Ø£Ø¹Ù…Ø¯Ø© -->
<div class="menu">
  <!-- ğŸ“ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£ÙˆÙ„Ù‰: Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø« -->
  <div class="box">
    <label for="searchName2">ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ø­Ø«:</label><br>
    <input type="text" id="searchName2" onkeyup="suggestNames()" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù…..." autocomplete="off" style="width: 100%;">
    <div id="nameSuggestions"></div>
  </div>

  <!-- âœ… Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø«Ø§Ù†ÙŠØ©: Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© -->
  <div class="box">
    <label>ğŸ“‘ Ø§Ø®ØªØ± Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø§Ù„ØªÙŠ ØªØ±ÙŠØ¯ Ø¹Ø±Ø¶Ù‡Ø§:</label><br>
    <div id="columnCheckboxes">
      <label><input type="checkbox" onchange="toggleAllColumns(this)"> Ø§Ø®ØªØ± Ø§Ù„ÙƒÙ„</label><br>
      <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¡ Ø§Ù„Ø£Ø¹Ù…Ø¯Ø© Ø¹Ø¨Ø± JavaScript -->
    </div>
  </div>

</div>

<br>
<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ø±Ø¶ ÙˆØ§Ù„Ø­ÙØ¸ -->
<button onclick="showSelectedResearcherData()">ğŸ“‹ Ø¹Ø±Ø¶ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
<button onclick="saveSelectedResearcherData()">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>

<hr>

<!-- Ø¹Ø±Ø¶ Ù†ØªÙŠØ¬Ø© Ø§Ù„Ø¨Ø§Ø­Ø« -->
<div id="selectedResult"></div>


  <datalist id="nameList"></datalist>
  <datalist id="columnList"></datalist>

  <div id="notice">âœ… ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­. ÙŠÙ…ÙƒÙ†Ùƒ Ø§Ù„Ø¢Ù† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù.</div>

  <div class="scrollable-table">
    <table id="csvTable">
      <thead></thead>
      <tbody></tbody>
    </table>
  </div>

  <div class="overlay" id="overlay"></div>
  <div class="popup" id="popup">
    <div id="popupMessage"></div>
    <button onclick="downloadPopupContent()">ğŸ“„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</button>
    <button onclick="closePopup()">âŒ Ø¥ØºÙ„Ø§Ù‚</button>
  </div>

  <script>
    if (sessionStorage.getItem("loggedIn") !== "true") {
      alert("ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø£ÙˆÙ„Ø§Ù‹.");
      window.location.href = "login.html";
    }

    const FILE_NAME = "researchers.csv";

    fetch(FILE_NAME)
      .then(res => res.text())
      .then(data => {
        const lines = data.trim().split("\n");
        const headers = lines[0].split(",");
        const thead = document.querySelector("#csvTable thead");
        const tbody = document.querySelector("#csvTable tbody");

        const headerRow = document.createElement("tr");
        headers.forEach(h => {
          const th = document.createElement("th");
          th.textContent = h;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);

        for (let i = 1; i < lines.length; i++) {
          const row = document.createElement("tr");
          lines[i].split(",").forEach(cell => {
            const td = document.createElement("td");
            const text = cell.trim();
            if (text.match(/(https?:\/\/[^\s]+|\b[\w.-]+\.(com|org|net|edu|gov)\b)/i)) {
              let url = text;
              if (!/^https?:\/\//i.test(url)) url = "https://" + url;
              td.innerHTML = `<a href="${url}" target="_blank" class="link">${text}</a>`;
            } else {
              td.textContent = text;
            }
            row.appendChild(td);
          });
          tbody.appendChild(row);
        }

        const nameList = document.getElementById("nameList");
        const nameSet = new Set();
        for (let i = 1; i < lines.length; i++) {
          const name = lines[i].split(",")[0].trim();
          nameSet.add(name);
        }
        nameSet.forEach(name => {
          const option = document.createElement("option");
          option.value = name;
          nameList.appendChild(option);
        });

        const columnList = document.getElementById("columnList");
        headers.forEach(header => {
          const option = document.createElement("option");
          option.value = header.trim();
          columnList.appendChild(option);
        });
      })
      .catch(err => {
        alert("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù.");
        console.error(err);
      });




      function showSelectedResearcherData() {
  const name = document.getElementById("searchName2").value.trim();
  const rows = [...document.querySelectorAll("#csvTable tbody tr")];
  const selectedCols = [...document.querySelectorAll(".column-check")]
                        .filter(chk => chk.checked)
                        .map(chk => parseInt(chk.value));
  const resultDiv = document.getElementById("selectedResult");
  resultDiv.innerHTML = "";

  for (const row of rows) {
    const cells = row.querySelectorAll("td");
    if (cells[0].textContent.trim() === name) {
      let html = `<b>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø«: ${name}</b><br><br>`;
      for (const i of selectedCols) {
        const label = document.querySelectorAll("#csvTable thead th")[i].textContent.trim();
        const value = cells[i] ? cells[i].textContent.trim() : "";
        html += `<b>${label}:</b> ${value}<br>`;
      }
      resultDiv.innerHTML = html;

      // Ø­ÙØ¸ Ù†ØµÙŠ Ù…Ø¤Ù‚Øª Ù„Ù„ØªÙ†Ø²ÙŠÙ„
      let text = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø«: ${name}\n\n`;
      for (const i of selectedCols) {
        const label = document.querySelectorAll("#csvTable thead th")[i].textContent.trim();
        const value = cells[i] ? cells[i].textContent.trim() : "";
        text += `${label}: ${value}\n`;
      }
      sessionStorage.setItem("selectedText", text);
      return;
    }
  }

  resultDiv.innerHTML = "âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù….";
}




      function saveSelectedResearcherData() {
  const name = document.getElementById("searchName2").value.trim() || "Ø¨ÙŠØ§Ù†Ø§Øª";
  const text = sessionStorage.getItem("selectedText") || "";
  const blob = new Blob([text], { type: "text/plain;charset=utf-8" });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `${name}.txt`;
  link.click();
}




    function logout() {
      sessionStorage.removeItem("loggedIn");
      window.location.href = "login.html";
    }

    function toggleAllColumns(master) {
  const checks = document.querySelectorAll(".column-check");
  checks.forEach(chk => chk.checked = master.checked);
}


window.onload = () => {
  const headers = [...document.querySelectorAll("#csvTable thead th")].map(th => th.textContent.trim());
  const container = document.getElementById("columnCheckboxes");

  for (let i = 0; i < headers.length; i++) {
    const label = document.createElement("label");
    label.innerHTML = `<input type="checkbox" class="column-check" value="${i}"> ${headers[i]}`;
    container.appendChild(label);
    container.appendChild(document.createElement("br"));
  }
};


function suggestNames() {
  const input = document.getElementById("searchName2").value.trim().toLowerCase();
  const rows = [...document.querySelectorAll("#csvTable tbody tr")];
  const suggestionBox = document.getElementById("nameSuggestions");
  suggestionBox.innerHTML = "";
  suggestionBox.style.display = "none";

  if (input.length === 0) return;

  const names = new Set();
  for (const row of rows) {
    const name = row.cells[0].textContent.trim();
    if (name.toLowerCase().includes(input)) {
      names.add(name);
    }
  }

  if (names.size === 0) return;

  for (const name of names) {
    const row = document.createElement("div");
    row.textContent = name;
    row.style.cursor = "pointer";
    row.style.padding = "4px";
    row.onclick = () => {
      document.getElementById("searchName2").value = name;
      suggestionBox.style.display = "none";
    };
    suggestionBox.appendChild(row);
  }

  suggestionBox.style.display = "block";
}


    function downloadCSV() {
      const link = document.createElement("a");
      link.href = FILE_NAME;
      link.download = FILE_NAME;
      link.click();
    }

    function searchColumnValue() {
      const name = document.getElementById("searchName").value.trim();
      const column = document.getElementById("columnName").value.trim();
      const headers = [...document.querySelectorAll("#csvTable thead th")].map(th => th.textContent.trim());
      const rows = [...document.querySelectorAll("#csvTable tbody tr")];

      const colIndex = headers.indexOf(column);
      if (colIndex === -1) {
        showPopup("âš  Ø§Ù„Ø¹Ù…ÙˆØ¯ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.");
        return;
      }

      for (const row of rows) {
        const cells = row.querySelectorAll("td");
        if (cells[0].textContent.trim() === name) {
          const value = cells[colIndex].textContent;
          showPopup(`ğŸ“Œ Ø§Ù„Ù‚ÙŠÙ…Ø© ÙÙŠ Ø§Ù„Ø¹Ù…ÙˆØ¯ "<b>${column}</b>" Ù„Ù„Ø¨Ø§Ø­Ø« "<b>${name}</b>" Ù‡ÙŠ:<br><br><span style="color:blue">${value}</span>`);
          return;
        }
      }

      showPopup("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù….");
    }

    function searchAndShowData() {
      const name = document.getElementById("searchName").value.trim();
      const rows = [...document.querySelectorAll("#csvTable tbody tr")];
      let result = "";

      for (const row of rows) {
        row.style.backgroundColor = "";
        const cells = row.querySelectorAll("td");
        if (cells.length === 0) continue;

        if (cells[0].textContent.trim() === name) {
          row.style.backgroundColor = "#ffff99";
          result = `Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø«: ${name}\n\n`;
          let htmlResult = `<b>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¨Ø§Ø­Ø«: ${name}</b><br><br>`;
          document.querySelectorAll("#csvTable thead th").forEach((th, i) => {
            const label = th.textContent.trim();
            const cell = cells[i];
            const value = cell ? cell.innerText.trim() : "";
            result += `${label}: ${value}\n`;
            if (cell && cell.querySelector("a")) {
              const linkText = cell.querySelector("a").textContent;
              const href = cell.querySelector("a").href;
              htmlResult += `<b>${label}:</b> <a href="${href}" target="_blank" class="link">${linkText}</a><br>`;
            } else {
              htmlResult += `<b>${label}:</b> ${value}<br>`;
            }
          });
          sessionStorage.setItem("popupText", result);
          showPopup(htmlResult);
          return;
        }
      }

      showPopup("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø§Ø³Ù….");
    }

    function showPopup(message) {
      document.getElementById("popupMessage").innerHTML = message;
      document.getElementById("overlay").style.display = "block";
      document.getElementById("popup").style.display = "block";
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
      document.getElementById("overlay").style.display = "none";
    }

    function downloadPopupContent() {
      const name = document.getElementById("searchName").value.trim() || "Ø¨ÙŠØ§Ù†Ø§Øª";
      const popupText = sessionStorage.getItem("popupText") || "";
      const blob = new Blob([popupText], { type: "text/plain;charset=utf-8" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${name}.txt`;
      link.click();
    }

    function toggleMenu(id) {
      const menu = document.getElementById(id);
      menu.style.display = menu.style.display === "block" ? "none" : "block";
    }

    // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø¹Ù†Ø¯ Ø§Ù„Ù†Ù‚Ø± Ø®Ø§Ø±Ø¬Ù‡Ø§
    document.addEventListener("click", function (event) {
      if (!event.target.closest(".menu")) {
        document.querySelectorAll(".dropdown").forEach(menu => menu.style.display = "none");
      }
    });
  </script>
</body>
</html>
